<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Modern Tetris</title>
  <!-- uiEnhancements is imported inside main.ts; removed duplicate script include to prevent double MutationObservers & event handlers -->
  <style>
    :root { color-scheme: dark; }
    * { box-sizing: border-box; }
    html, body { height:100%; }
  body { margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif; background: radial-gradient(circle at 35% 22%, #161A2B 0%, #0F1220 65%) fixed; color:#e5e7eb; -webkit-font-smoothing: antialiased; }
  #stage { padding:10px 12px; }
  .app-shell { display:flex; gap:18px; align-items:flex-start; justify-content:center; max-width:900px; margin:0 auto; }
    @media (max-width: 760px){ .app-shell { flex-direction:column; align-items:stretch; gap:20px; } #stage{ padding:12px 10px 40px; } }
  canvas { background:#0F1220; display:block; image-rendering:pixelated; box-shadow:0 0 0 1px rgba(255,255,255,0.05),0 4px 18px -6px rgba(0,0,0,0.85); border-radius:8px; }
  #gameWrap { position:relative; border-radius:8px; }
  #gameWrap:before { content:""; position:absolute; inset:0; pointer-events:none; border-radius:8px; box-shadow:inset 0 0 18px -4px rgba(102,209,255,0.28), inset 0 0 4px 0 rgba(183,240,255,0.12); }
    @media (max-width: 380px) { canvas { width:240px; height:480px; } }
    /* Prevent accidental scroll / bounce when interacting */
    canvas, .control-grid, button { touch-action:none; -webkit-touch-callout:none; }
    #gameWrap { position:relative; }
    #overlay { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-size:54px; font-weight:700; letter-spacing:2px; font-family:inherit; background:rgba(0,0,0,0.55); backdrop-filter: blur(2px); color:#fff; opacity:0; transition:opacity .25s; pointer-events:none; border-radius:6px; }
    #overlay.visible { opacity:1; }
  .panel { width:250px; max-width:100%; display:flex; flex-direction:column; height:600px; }
  .panel-bottom { margin-top:10px; }
  .logo-wrap { text-align:center; margin:0 0 4px; }
  .logo-wrap img { width:100%; height:auto; max-height:180px; display:block; margin:0 auto; object-fit:contain; filter:drop-shadow(0 3px 10px rgba(0,0,0,0.55)); }
  .stats { display:flex; flex-direction:column; gap:8px; }
  .stat { background:linear-gradient(152deg, rgba(255,255,255,0.052), rgba(255,255,255,0.018)); padding:6px 8px 6px; border-radius:10px; position:relative; box-shadow:inset 0 0 0 1px rgba(255,255,255,0.045),0 1.5px 3.5px -2px rgba(0,0,0,0.55); display:flex; flex-direction:column; justify-content:flex-start; min-height:48px; }
  .score-primary { min-height:76px; padding:9px 12px 10px; border:1px solid rgba(120,156,255,0.35); box-shadow:0 4px 14px -6px rgba(48,84,255,0.55),0 0 0 1px rgba(255,255,255,0.10) inset,0 0 0 1px rgba(120,156,255,0.25); background:linear-gradient(155deg, rgba(120,156,255,0.28), rgba(120,156,255,0.08)); }
  .score-primary .stat-val { font-size:24px; }
  .mini-stats { display:grid; grid-template-columns:repeat(2,1fr); gap:6px; }
  .stat.mini { min-height:44px; padding:6px 7px 6px; }
  .high-badge { position:absolute; top:6px; right:8px; background:linear-gradient(135deg, rgba(255,255,255,0.18), rgba(255,255,255,0.05)); border:1px solid rgba(255,255,255,0.18); padding:2px 8px 3px; border-radius:20px; font-size:11px; font-weight:600; letter-spacing:.5px; display:flex; align-items:center; gap:4px; box-shadow:0 2px 4px -2px rgba(0,0,0,0.6); }
  .high-badge .icon { filter:drop-shadow(0 0 4px rgba(255,255,255,0.3)); }
  @keyframes badgePop { 0%{ transform:scale(0.9); box-shadow:0 0 0 0 rgba(255,220,120,0); } 30%{ transform:scale(1.15); box-shadow:0 0 12px 2px rgba(255,220,120,0.55);} 60%{ transform:scale(1); box-shadow:0 0 6px 1px rgba(255,220,120,0.35);} 100%{ transform:scale(1); box-shadow:0 0 0 0 rgba(255,220,120,0);} }
  .high-badge.badge-pop { animation: badgePop 1.1s ease; }
  /* Stat icon styles */
  .lines-card .stat-label:before { content:""; display:inline-block; width:8px; height:8px; background:linear-gradient(135deg,#4f7ff9,#8b5cf6); margin-right:4px; border-radius:2px; box-shadow:0 0 4px -1px rgba(79,127,249,0.7); }
  .level-card .stat-label:before { content:"⚡"; display:inline-block; margin-right:4px; font-size:11px; line-height:1; transform:translateY(-1px); filter:drop-shadow(0 0 4px rgba(255,226,140,0.45)); color:#f5d978; }
  .stat.emphasis { background:linear-gradient(155deg, rgba(120,156,255,0.22), rgba(120,156,255,0.07)); box-shadow:0 4px 14px -6px rgba(48,84,255,0.55), inset 0 0 0 1px rgba(255,255,255,0.08); }
  .stat-label { font-size:10px; text-transform:uppercase; letter-spacing:.65px; color:#b9bec6; font-weight:600; }
  .stat-val { display:block; font-size:15px; font-weight:700; margin-top:2px; font-variant-numeric: tabular-nums; font-feature-settings:'tnum','ss01'; line-height:1.05; }
    .stat.emphasis.pulse { animation:statPulse 0.65s ease; }
    @keyframes statPulse { 0%{ transform:scale(1); } 35%{ transform:scale(1.035); } 70%{ transform:scale(0.992); } 100%{ transform:scale(1); } }
  /* Score pop animation */
  @keyframes scorePop { 0%{ transform:scale(1); } 20%{ transform:scale(1.18); filter:drop-shadow(0 0 6px rgba(120,156,255,0.8)); } 50%{ transform:scale(1.05);} 100%{ transform:scale(1); filter:none; } }
  .score-pop { animation:scorePop .45s cubic-bezier(.45,.1,.2,1); }
  /* Lines flash */
  @keyframes linesFlash { 0%{ box-shadow:0 0 0 1px rgba(255,255,255,0.55),0 0 12px -2px rgba(120,156,255,0.9); background:linear-gradient(155deg, rgba(120,156,255,0.35), rgba(120,156,255,0.08)); } 100%{ box-shadow:inset 0 0 0 1px rgba(255,255,255,0.04),0 1.5px 3.5px -2px rgba(0,0,0,0.55); } }
  .lines-flash { animation:linesFlash .5s ease; }
  /* Start button running fade */
  #startBtn.running { opacity:.55; }
    /* Active score subtle breathing glow */
    @keyframes scoreActiveGlow { 0%{ box-shadow:0 4px 14px -6px rgba(48,84,255,0.55),0 0 0 1px rgba(120,156,255,0.25),0 0 8px -2px rgba(120,156,255,0.55) inset; }
      50%{ box-shadow:0 4px 16px -6px rgba(90,140,255,0.75),0 0 0 1px rgba(150,176,255,0.35),0 0 14px -2px rgba(140,170,255,0.85) inset; }
      100%{ box-shadow:0 4px 14px -6px rgba(48,84,255,0.55),0 0 0 1px rgba(120,156,255,0.25),0 0 8px -2px rgba(120,156,255,0.55) inset; } }
    .score-active.score-primary { animation: scoreActiveGlow 3s ease-in-out infinite; }
    /* READY electric pulse */
    @keyframes readyPulse { 0%{ text-shadow:0 0 8px rgba(120,156,255,0.55),0 0 18px rgba(94,140,255,0.25); opacity:0.85; }
      45%{ text-shadow:0 0 16px rgba(160,200,255,0.9),0 0 34px rgba(120,156,255,0.6); opacity:1; }
      100%{ text-shadow:0 0 8px rgba(120,156,255,0.55),0 0 18px rgba(94,140,255,0.25); opacity:0.85; } }
    #overlay.ready-pulse { animation: readyPulse 1.8s ease-in-out infinite; }
    /* Start button energy hover */
    .btn-primary:not(.running):hover { box-shadow:0 0 0 1px rgba(255,255,255,0.25) inset,0 0 12px 2px rgba(120,156,255,0.65),0 4px 10px -3px rgba(48,84,255,0.6); }
    /* Countdown animations */
    @keyframes countdownPulse { 0%{ transform:scale(.6); opacity:0; filter:blur(2px); }
      20%{ opacity:1; filter:blur(0); }
      55%{ transform:scale(1.05); }
      100%{ transform:scale(.2); opacity:0; filter:blur(4px); } }
    #overlay.counting { background:rgba(0,0,0,0.25); animation:none; }
    #overlay.counting .count-num { display:block; animation:countdownPulse 1s cubic-bezier(.55,.1,.35,1); font-size:110px; letter-spacing:4px; }
    #overlay.counting.go .count-num { font-size:78px; }
  #overlay.counting .count-num.go { background:linear-gradient(135deg,#5fa9ff,#9fabff); -webkit-background-clip:text; background-clip:text; color:transparent; text-shadow:0 0 14px rgba(120,156,255,0.75),0 0 28px rgba(120,156,255,0.45); }
  .progress-wrap { height:5px; margin-top:6px; border-radius:3px; background:rgba(255,255,255,0.12); overflow:hidden; position:relative; box-shadow:inset 0 0 0 1px rgba(0,0,0,0.4); }
  .progress-bar { position:absolute; left:0; top:0; bottom:0; width:0%; background:linear-gradient(90deg,#4f7ff9,#8b5cf6); box-shadow:0 0 0 1px rgba(255,255,255,0.1),0 0 10px -2px #4f7ff9; transition:width .25s cubic-bezier(.4,.0,.2,1); }
    .delta { font-size:12px; font-weight:600; color:#10b981; opacity:0; transform:translateY(4px); transition: all .3s; }
    .delta.visible { opacity:1; transform:translateY(0); }
    .toast-layer { position:relative; min-height:40px; }
    .toast-layer .toast { position:absolute; right:0; top:0; background:rgba(17,24,39,0.9); padding:8px 14px 9px; border-radius:8px; font-size:13px; font-weight:600; letter-spacing:.5px; animation:toastIn .35s ease; box-shadow:0 4px 14px -6px rgba(0,0,0,0.9),0 0 0 1px rgba(255,255,255,0.06); backdrop-filter: blur(4px); }
    .toast.good { background:linear-gradient(135deg, rgba(34,197,94,0.85), rgba(34,197,94,0.65)); color:#022c16; }
    .toast.out { animation:toastOut .42s ease forwards; }
    @keyframes toastIn { 0%{ opacity:0; transform:translateY(-8px) scale(.95);} 100%{ opacity:1; transform:translateY(0) scale(1);} }
    @keyframes toastOut { 0%{ opacity:1; transform:translateY(0) scale(1);} 100%{ opacity:0; transform:translateY(-8px) scale(.93);} }
  .divider { height:1px; background:linear-gradient(90deg,rgba(255,255,255,0.14),rgba(255,255,255,0.02)); opacity:0.9; }
  button { cursor:pointer; outline:none; background:linear-gradient(150deg, rgba(255,255,255,0.10), rgba(255,255,255,0.02)); color:#fff; border:1px solid rgba(255,255,255,0.14); border-radius:7px; font-size:11px; padding:5px 8px 6px; font-weight:600; letter-spacing:.35px; font-family:inherit; transition:background .15s, transform .13s, border-color .18s, box-shadow .25s; position:relative; }
  .btn-primary { background:linear-gradient(140deg,#4f7ff9,#6f4ff9); border-color:#5a6ff5; box-shadow:0 4px 10px -4px rgba(80,120,255,0.55),0 0 0 1px rgba(255,255,255,0.08) inset; }
  .btn-primary:hover { background:linear-gradient(140deg,#6b8ffb,#855cfb); }
  .btn-primary:active { transform:translateY(2px); }
  .btn-secondary { background:linear-gradient(150deg, rgba(255,255,255,0.05), rgba(255,255,255,0.015)); border-color:rgba(255,255,255,0.14); opacity:0.85; }
  .btn-secondary:hover { background:linear-gradient(145deg, rgba(255,255,255,0.12), rgba(255,255,255,0.04)); opacity:0.95; }
  .btn-secondary:active { transform:translateY(2px); }
    button:hover { background:linear-gradient(145deg, rgba(255,255,255,0.22), rgba(255,255,255,0.05)); }
    button:active { transform:translateY(2px); }
  .control-cluster { margin:6px auto 0; padding:6px 8px 8px; background:linear-gradient(145deg, rgba(255,255,255,0.05), rgba(255,255,255,0.015)); border:1px solid rgba(255,255,255,0.09); border-radius:10px; box-shadow:0 2px 4px -2px rgba(0,0,0,0.6), inset 0 0 0 1px rgba(255,255,255,0.04); }
  .control-grid { display:grid; grid-template-columns:repeat(3,28px); grid-template-rows:repeat(3,28px); gap:2px; justify-content:center; width:max-content; }
  .control-grid button { width:28px; height:28px; font-size:13px; font-weight:600; padding:0; display:flex; align-items:center; justify-content:center; }
  .control-grid .blank { pointer-events:none; opacity:0; }
  .foot-bar { margin-top:6px; font-size:10px; opacity:0.75; text-align:center; background:linear-gradient(145deg, rgba(255,255,255,0.06), rgba(255,255,255,0.015)); border:1px solid rgba(255,255,255,0.09); padding:4px 6px 5px; border-radius:6px; font-weight:500; letter-spacing:.4px; }
    .foot { font-size:12px; opacity:0.65; line-height:1.4; }
    @media (max-width: 520px){ .panel { width:100%; } .app-shell { gap:16px; } .control-grid { gap:6px; } .control-grid button { width:48px; height:48px; } #gameWrap { margin:0 auto; } }
  </style>
</head>
<body>
  <div id="stage">
  <div id="root" class="app-shell">
      <div id="gameWrap" class="card-equal">
        <canvas id="game" width="300" height="600"></canvas>
        <div id="overlay" class="visible">READY</div>
      </div>
      <div class="panel">
        <div class="logo-wrap">
          <img id="gameLogo" alt="Tetris Logo" decoding="async" />
        </div>
        <div class="stats">
          <div id="score" class="stat score-primary emphasis">
            <div class="stat-top"><span class="stat-label">Score</span><span class="delta" id="scoreDelta"></span></div>
            <span id="scoreVal" class="stat-val">0</span>
            <div class="progress-wrap"><div id="levelProgress" class="progress-bar"></div></div>
            <div class="high-badge" title="High Score"><span class="icon">⭐</span><span id="highVal">0</span></div>
          </div>
          <div class="mini-stats">
            <div id="lines" class="stat mini lines-card"><span class="stat-label">Lines</span><span id="linesVal" class="stat-val">0</span></div>
            <div id="level" class="stat mini level-card"><span class="stat-label">Level</span><span id="levelVal" class="stat-val">1</span></div>
          </div>
        </div>
        <div id="toastLayer" class="toast-layer"></div>
        <div class="panel-bottom">
          <div class="divider" style="margin:6px 0 4px;"></div>
          <div style="display:flex; gap:6px; margin-top:4px; justify-content:center;">
            <button id="startBtn" class="btn-primary" style="flex:1;">Start</button>
            <button id="resetBtn" class="btn-secondary" style="flex:0.9;">Reset</button>
          </div>
          <div class="divider" style="margin:6px 0 4px;"></div>
          <div class="control-cluster">
            <div class="control-grid">
              <div class="blank"></div>
              <button id="btnUp" title="Rotate (Up Arrow)">▲</button>
              <div class="blank"></div>
              <button id="btnLeft" title="Move Left (Left Arrow)">◀</button>
              <button id="btnDown" title="Soft Drop (Down Arrow)">▼</button>
              <button id="btnRight" title="Move Right (Right Arrow)">▶</button>
              <div class="blank"></div>
              <button id="btnHard" title="Hard Drop (Shift)">⤓</button>
              <div class="blank"></div>
            </div>
            <div class="foot-bar">Arrows Move / Up Rotate / Down Soft Drop / Shift Hard Drop / Space Pause</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script type="module" src="/src/main.ts"></script>
</body>
</html>
